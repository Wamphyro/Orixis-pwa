# üìä DetailViewerWidget - Documentation

Widget modal autonome pour afficher le d√©tail d'un √©l√©ment avec timeline int√©gr√©e et sections configurables.

## üöÄ Installation

```javascript
import { DetailViewerWidget } from '/widgets/detail-viewer/detail-viewer.widget.js';
```

## üìù Utilisation basique

```javascript
const viewer = new DetailViewerWidget({
    title: 'Facture #123',
    data: factureData,
    sections: [
        {
            id: 'info',
            title: 'üìã Informations',
            fields: [
                { label: 'Num√©ro', key: 'numero' },
                { label: 'Date', key: 'date', formatter: 'date' }
            ]
        }
    ]
});
```

## ‚öôÔ∏è Configuration compl√®te

### Options principales

| Option | Type | D√©faut | Description |
|--------|------|--------|-------------|
| `title` | string | 'D√©tail' | Titre du modal |
| `subtitle` | string | null | Sous-titre optionnel |
| `data` | object | {} | Donn√©es √† afficher |
| `theme` | string | 'default' | Th√®me visuel ('default', 'minimal', 'dark') |
| `size` | string | 'large' | Taille ('small', 'medium', 'large', 'xlarge') |
| `autoOpen` | boolean | true | Ouvrir automatiquement |
| `destroyOnClose` | boolean | false | D√©truire apr√®s fermeture |
| `closeOnOverlay` | boolean | true | Fermer au clic sur overlay |
| `closeOnEscape` | boolean | true | Fermer avec Escape |

### Timeline (optionnelle)

```javascript
timeline: {
    enabled: true,              // Activer/d√©sactiver
    items: [                    // √âtapes de la timeline
        {
            label: 'Cr√©√©e',
            icon: 'üìù',         // Emoji ou texte
            status: 'completed', // completed|active|pending|error|warning
            date: '01/02/2025',
            description: 'Facture cr√©√©e'  // Texte optionnel sous la date
        },
        {
            label: 'En cours',
            icon: '‚è≥',
            status: 'active',
            date: '03/02/2025',
            description: 'En attente de paiement'
        }
    ],
    theme: 'colorful',          // default|minimal|colorful
    size: 'medium',             // small|medium|large
    orientation: 'horizontal',  // horizontal|vertical
    animated: true,             // Animations
    showDates: true,           // Afficher les dates
    showLabels: true,          // Afficher les labels
    pulse: true                // Animation pulse sur l'actif
}
```

### Sections configurables

```javascript
sections: [
    {
        id: 'fournisseur',           // ID unique
        title: 'üè¢ Fournisseur',     // Titre avec ic√¥ne
        enabled: true,               // Visible ou non
        collapsible: false,          // Peut √™tre repli√©
        collapsed: false,            // √âtat initial si collapsible
        layout: 'grid',              // grid|list|table
        className: 'custom-class',   // Classes CSS additionnelles
        
        fields: [
            {
                label: 'Nom',        // Label affich√©
                key: 'fournisseur.nom', // Chemin dans data (notation point√©e)
                value: 'Valeur fixe',   // OU valeur directe
                
                // Formatage
                formatter: 'currency',  // Voir types ci-dessous
                formatterOptions: {     // Options du formatter
                    currency: 'EUR'
                },
                
                // Style
                bold: false,            // Texte en gras
                className: '',          // Classes CSS
                fullWidth: false,       // Prend toute la largeur
                
                // Autres
                defaultValue: '-',      // Si valeur vide
                html: false,           // Si true, ne pas √©chapper HTML
                visible: true          // Afficher ou non
            }
        ],
        
        // OU contenu HTML personnalis√©
        customContent: '<div>Mon HTML</div>'
    }
]
```

### Types de formatters

| Formatter | Description | Options | Exemple |
|-----------|-------------|---------|---------|
| `currency` | Montant mon√©taire | `currency: 'EUR'` | 1234.56 ‚Üí 1 234,56 ‚Ç¨ |
| `number` | Nombre format√© | Options Intl.NumberFormat | 1234.56 ‚Üí 1 234,56 |
| `percent` | Pourcentage | `decimals: 2` | 0.15 ‚Üí 15% |
| `date` | Date | Options toLocaleDateString | 2025-02-09 ‚Üí 09/02/2025 |
| `datetime` | Date et heure | Options toLocaleString | ‚Üí 09/02/2025 14:30 |
| `boolean` | Oui/Non | `trueText`, `falseText` | true ‚Üí Oui |
| `badge` | Badge color√© | `class`, `icon` | ‚Üí `<span class="badge">...</span>` |
| `function` | Fonction custom | `(value, options) => string` | Personnalis√© |

### Actions (boutons footer)

```javascript
actions: [
    {
        label: 'Valider',
        icon: '‚úÖ',              // Ic√¥ne optionnelle
        style: 'primary',        // Utilise buttonClasses[style]
        class: 'btn btn-glass-blue btn-lg',  // OU classe directe
        disabled: false,         // √âtat d√©sactiv√©
        closeOnClick: true,      // Fermer apr√®s clic
        data: { id: 123 },       // Data attributes
        show: (data) => data.statut === 'nouveau',  // Condition d'affichage
        onClick: (data, widget) => {
            console.log('Valid√©!', data);
            // return true pour fermer, false pour garder ouvert
        }
    }
]
```

## üé® Syst√®me de styles centralis√© ‚úÖ NOUVEAU

### Chargement automatique
Le widget charge automatiquement via `loadWidgetStyles()` :
- `buttons.css` - Tous les styles de boutons
- `badges.css` - Tous les styles de badges  
- `modal-base.css` - Styles de base des modals

### Classes disponibles pour les actions

```javascript
// Boutons avec ic√¥nes pr√©d√©finies
'btn btn-view-icon'      // ≈íil vert (voir)
'btn btn-delete-icon'    // Poubelle rouge (supprimer)
'btn btn-edit-icon'      // Crayon bleu (modifier)

// Boutons glass (fond clair)
'btn btn-glass-blue'     // Bleu transparent
'btn btn-glass-red'      // Rouge transparent
'btn btn-glass-green'    // Vert transparent
'btn btn-glass-orange'   // Orange transparent
'btn btn-glass-purple'   // Violet transparent

// Boutons solid (plus opaques)
'btn btn-glass-solid-blue'   // Bleu opaque
'btn btn-glass-solid-red'    // Rouge opaque
'btn btn-glass-solid-green'  // Vert opaque

// Combinaisons avec tailles
'btn btn-glass-blue btn-lg'  // Grand bouton bleu
'btn btn-glass-red btn-sm'   // Petit bouton rouge
```

### Exemple d'utilisation des classes

```javascript
actions: [
    {
        label: 'Voir le document',
        class: 'btn btn-view-icon btn-lg',  // Gros bouton ≈ìil
        onClick: (data) => window.open(data.url)
    },
    {
        label: 'Valider',
        class: 'btn btn-glass-solid-blue btn-lg',  // Gros bouton bleu solid
        onClick: async (data) => { ... }
    },
    {
        label: 'Supprimer',
        class: 'btn btn-glass-red',  // Bouton rouge transparent
        onClick: (data) => { ... }
    }
]
```

## üìå API Publique

### M√©thodes

```javascript
// Contr√¥le du modal
viewer.open();                      // Ouvrir le modal
viewer.close();                     // Fermer le modal

// Mise √† jour des donn√©es
viewer.update({ nouveauChamp: 'valeur' });  // MAJ partielle des donn√©es
viewer.refresh();                           // Rafra√Æchir tout l'affichage

// Sections
viewer.toggleSection('sectionId');          // Replier/d√©plier une section

// Actions
viewer.handleAction(index);                 // D√©clencher une action par index

// Nettoyage
viewer.destroy();                           // Destruction compl√®te du widget
```

### Propri√©t√©s

```javascript
viewer.id           // ID unique du widget
viewer.state        // √âtat interne {isOpen, loaded, currentData}
viewer.config       // Configuration compl√®te
viewer.elements     // R√©f√©rences DOM {overlay, modal, body, ...}
```

## üí° Exemples complets

### Facture d√©taill√©e avec timeline et actions

```javascript
const factureViewer = new DetailViewerWidget({
    title: `Facture ${facture.numero}`,
    subtitle: `${facture.fournisseur} - ${facture.montantTTC}‚Ç¨`,
    data: facture,
    
    timeline: {
        enabled: true,
        items: [
            { 
                label: 'Cr√©√©e', 
                status: 'completed', 
                date: '01/02/2025',
                description: 'Facture upload√©e',
                icon: 'üìÑ'
            },
            { 
                label: 'Analys√©e', 
                status: 'completed', 
                date: '01/02/2025',
                description: 'Extraction IA r√©ussie',
                icon: 'ü§ñ'
            },
            { 
                label: '√Ä payer', 
                status: 'active', 
                date: '02/02/2025',
                description: 'En attente de paiement',
                icon: 'üí≥'
            },
            { 
                label: 'Pay√©e', 
                status: 'pending',
                icon: 'üí∞'
            },
            { 
                label: 'Point√©e', 
                status: 'pending',
                icon: '‚úì‚úì'
            }
        ],
        theme: 'colorful',
        orientation: 'horizontal'
    },
    
    sections: [
        {
            id: 'identifiants',
            title: 'üî¢ Identifiants',
            layout: 'grid',
            fields: [
                { label: 'N¬∞ Facture', key: 'numeroFacture', bold: true },
                { label: 'N¬∞ Interne', key: 'numeroInterne', bold: true },
                { label: 'SIRET', key: 'identifiants.siret' },
                { label: 'TVA Intra', key: 'identifiants.numeroTVAIntra' }
            ]
        },
        {
            id: 'montants',
            title: 'üí∞ Montants',
            layout: 'table',
            fields: [
                { label: 'Montant HT', key: 'montantHT', formatter: 'currency' },
                { label: 'TVA 20%', key: 'montantTVA', formatter: 'currency' },
                { 
                    label: 'Montant TTC', 
                    key: 'montantTTC', 
                    formatter: 'currency',
                    bold: true,
                    formatter: (v) => `<strong style="color: var(--primary);">${v}</strong>`,
                    html: true
                }
            ]
        },
        {
            id: 'dates',
            title: 'üìÖ Dates importantes',
            collapsible: true,
            fields: [
                { label: 'Date facture', key: 'dateFacture', formatter: 'date' },
                { 
                    label: '√âch√©ance', 
                    key: 'dateEcheance', 
                    formatter: (v, data) => {
                        const date = new Date(v);
                        const aujourd = new Date();
                        if (date < aujourd && data.statut === 'a_payer') {
                            return `<span style="color: red;">${date.toLocaleDateString('fr-FR')} (En retard)</span>`;
                        }
                        return date.toLocaleDateString('fr-FR');
                    },
                    html: true
                }
            ]
        }
    ],
    
    actions: [
        {
            label: 'Marquer pay√©e',
            class: 'btn btn-glass-solid-green btn-lg',
            icon: 'üí∞',
            show: (data) => data.statut === 'a_payer',
            onClick: async (data, widget) => {
                await marquerPayee(data.id);
                widget.close();
                return true;
            }
        },
        {
            label: 'Export comptable',
            class: 'btn btn-glass-purple btn-lg',
            icon: 'üìä',
            onClick: (data) => {
                exportComptable(data);
                return false; // Ne pas fermer
            }
        },
        {
            label: 'Supprimer',
            class: 'btn btn-glass-red',
            icon: 'üóëÔ∏è',
            closeOnClick: false,
            onClick: async (data, widget) => {
                if (confirm('Supprimer cette facture ?')) {
                    await supprimerFacture(data.id);
                    widget.close();
                    return true;
                }
                return false;
            }
        }
    ]
});
```

### Visualisation simple sans timeline

```javascript
const simpleViewer = new DetailViewerWidget({
    title: 'D√©tails commande',
    data: commande,
    timeline: { enabled: false },  // Pas de timeline
    sections: [
        {
            id: 'client',
            title: 'üë§ Client',
            fields: [
                { label: 'Nom', key: 'client.nom' },
                { label: 'Email', key: 'client.email' },
                { label: 'T√©l√©phone', key: 'client.telephone' }
            ]
        },
        {
            id: 'commande',
            title: 'üì¶ Commande',
            fields: [
                { label: 'R√©f√©rence', key: 'reference', bold: true },
                { label: 'Date', key: 'date', formatter: 'date' },
                { label: 'Total', key: 'total', formatter: 'currency' },
                { 
                    label: 'Statut', 
                    value: 'En cours',
                    formatter: 'badge',
                    formatterOptions: { class: 'badge-warning' }
                }
            ]
        }
    ],
    actions: []  // Pas de boutons d'action
});
```

### Avec formatter personnalis√© et HTML

```javascript
sections: [{
    id: 'documents',
    title: 'üìÑ Documents',
    fields: [
        {
            label: 'Fichiers upload√©s',
            key: 'documents',
            formatter: (docs) => {
                if (!docs || docs.length === 0) return 'Aucun document';
                return docs.map(d => `
                    <div style="margin: 8px 0;">
                        <div style="display: flex; justify-content: space-between;">
                            <span>üìé ${d.nom}</span>
                            <a href="${d.url}" target="_blank" class="btn btn-view-icon btn-sm"></a>
                        </div>
                    </div>
                `).join('');
            },
            html: true
        }
    ]
}]
```

## üé® Personnalisation CSS

Le widget utilise des variables CSS pour la personnalisation :

```css
/* Override dans votre CSS */
:root {
    --dv-primary: #8b5cf6;        /* Couleur principale */
    --dv-primary-light: #a78bfa;  /* Variante claire */
    --dv-border: #e5e7eb;          /* Bordures */
    --dv-shadow-xl: 0 20px 40px -10px rgb(0 0 0 / 0.2);
}
```

## üì¶ Structure des fichiers

```
/widgets/detail-viewer/
‚îú‚îÄ‚îÄ detail-viewer.widget.js   # Logique du widget
‚îú‚îÄ‚îÄ detail-viewer.widget.css  # Styles sp√©cifiques (auto-charg√©)
‚îî‚îÄ‚îÄ README.md                 # Cette documentation

/src/
‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îî‚îÄ‚îÄ widget-styles-loader.js  # ‚úÖ Chargeur de styles centralis√©
‚îú‚îÄ‚îÄ css/
‚îÇ   ‚îî‚îÄ‚îÄ components/
‚îÇ       ‚îú‚îÄ‚îÄ buttons.css          # Styles des boutons (charg√© auto)
‚îÇ       ‚îú‚îÄ‚îÄ badges.css           # Styles des badges (charg√© auto)
‚îÇ       ‚îî‚îÄ‚îÄ modal-base.css       # Styles modals (charg√© auto)
```

## ‚ö†Ô∏è Notes importantes

- **Timeline int√©gr√©e** : Design identique au composant Timeline original
- **Styles centralis√©s** : Charge automatiquement buttons.css, badges.css, modal-base.css
- **Destruction** : Toujours appeler `destroy()` pour √©viter les fuites m√©moire
- **Donn√©es imbriqu√©es** : Utiliser la notation point√©e (`user.address.city`)
- **Responsive** : S'adapte automatiquement mobile/desktop
- **Classes pr√©d√©finies** : Utiliser les classes CSS des boutons pour coh√©rence

## üîÑ Cycle de vie

```
new DetailViewerWidget()
    ‚Üì
loadCSS()
    ‚îú‚îÄ‚îÄ loadWidgetStyles()  // ‚úÖ Charge styles communs
    ‚îî‚îÄ‚îÄ Charge CSS sp√©cifique
    ‚Üì
init()
    ‚îú‚îÄ‚îÄ render()
    ‚îú‚îÄ‚îÄ attachEvents()
    ‚îî‚îÄ‚îÄ showWithDelay()
    ‚Üì
open() [auto ou manuel]
    ‚Üì
[Interactions utilisateur]
    ‚îú‚îÄ‚îÄ update()
    ‚îú‚îÄ‚îÄ refresh()
    ‚îî‚îÄ‚îÄ toggleSection()
    ‚Üì
close()
    ‚Üì
destroy() [optionnel ou auto si destroyOnClose]
```

## üìä Changelog

### v1.0.1 (09/02/2025)
- ‚úÖ Int√©gration du syst√®me de styles centralis√©
- ‚úÖ Utilisation de `loadWidgetStyles()`
- ‚úÖ Documentation des classes de boutons disponibles

### v1.0.0 (08/02/2025)
- Version initiale
- Timeline int√©gr√©e
- Sections configurables
- Actions dynamiques

---

**Version** : 1.0.1  
**Auteur** : Assistant Claude  
**Date** : 09/02/2025  
**Mise √† jour** : Ajout syst√®me de styles centralis√©
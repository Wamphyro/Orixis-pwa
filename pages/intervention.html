<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SAV Audio - Interventions</title>
    
    <!-- PWA Meta Tags -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="SAV Audio">
    <link rel="manifest" href="../manifest.json">
    <meta name="theme-color" content="#667eea">
    
    <!-- ========================================
         CSS - Ordre de chargement optimis√©
         ======================================== -->
    
    <!-- 1. Base et layout -->
    <link rel="stylesheet" href="../src/css/main.css">

    <!-- 2. Composants UI partag√©s -->
    <link rel="stylesheet" href="../src/css/shared/ui/animation.css">
    <link rel="stylesheet" href="../src/css/shared/ui/badge.css">
    <link rel="stylesheet" href="../src/css/shared/ui/form.css">
    <link rel="stylesheet" href="../src/css/shared/ui/modal.css">
    <link rel="stylesheet" href="../src/css/shared/ui/dialog.css">
    <link rel="stylesheet" href="../src/css/shared/ui/notification.css">
    <link rel="stylesheet" href="../src/css/shared/ui/timeline.css">
    <link rel="stylesheet" href="../src/css/shared/ui/search-dropdown.css">
    <link rel="stylesheet" href="../src/css/shared/ui/stepper.css">
    <link rel="stylesheet" href="../src/css/shared/ui/datatable.css">
    <link rel="stylesheet" href="../src/css/shared/ui/datatable-filters.css">
    <link rel="stylesheet" href="../src/css/shared/ui/dropdown-list.css">
    <link rel="stylesheet" href="../src/css/shared/ui/button.css">
    <link rel="stylesheet" href="../src/css/shared/ui/stats-cards.css">

    <!-- 3. CSS sp√©cifiques aux interventions -->
    <link rel="stylesheet" href="../src/css/intervention/intervention.css">
    <link rel="stylesheet" href="../src/css/intervention/intervention-custom.css">
    
    <!-- EmailJS -->
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script>
        (function() {
            try {
                emailjs.init("wJtv5MrJPzvMuGSyL");
                console.log("EmailJS initialis√© avec succ√®s");
            } catch(error) {
                console.error("Erreur initialisation EmailJS:", error);
            }
        })();
    </script>
</head>
<body>
    <!-- Container pour le composant AppHeader -->
    <!-- AppHeader sera inject√© ici par JavaScript -->
    
    <div class="container">
        <!-- Barre d'actions et statistiques -->
        <div class="interventions-header">
            <div class="interventions-stats">
                <!-- StatsCards va g√©n√©rer le contenu ici -->
            </div>
            
            <div class="interventions-actions">
                <button class="btn btn-primary btn-with-icon" onclick="ouvrirNouvelleIntervention()">
                    <span>‚ûï</span> Nouvelle intervention
                </button>
            </div>
        </div>

        <!-- Filtres -->
        <div class="interventions-filters section">
            <!-- DataTableFilters va g√©n√©rer le contenu ici -->
        </div>

        <!-- Container pour DataTable -->
        <div class="interventions-table-container section">
            <!-- DataTable sera g√©n√©r√© ici -->
        </div>
    </div>

    <!-- Modal Nouvelle Intervention -->
    <div id="modalNouvelleIntervention" class="modal" style="display: none;">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2>üîß Nouvelle Intervention SAV</h2>
                <button class="modal-close">&times;</button>
            </div>
            
            <!-- Indicateur d'√©tapes -->
            <div class="stepper">
                <div class="step active" id="step1">
                    <div class="step-number">1</div>
                    <div class="step-label">Client & Appareil</div>
                </div>
                <div class="step" id="step2">
                    <div class="step-number">2</div>
                    <div class="step-label">Diagnostic</div>
                </div>
                <div class="step" id="step3">
                    <div class="step-number">3</div>
                    <div class="step-label">Actions & R√©sultat</div>
                </div>
                <div class="step" id="step4">
                    <div class="step-number">4</div>
                    <div class="step-label">Validation</div>
                </div>
            </div>
            
            <div class="modal-body">
                <!-- √âtape 1 : Client & Appareil -->
                <div class="step-content" id="stepContent1">
                    <h3>üìã Informations Client</h3>
                    
                    <div class="client-search-container form-group">
                        <label for="nom">Nom du client <span style="color: #dc3545;">*</span></label>
                        <div class="client-search-wrapper">
                            <!-- SearchDropdown sera initialis√© ici -->
                        </div>
                    </div>
                    
                    <div class="client-selected" id="clientSelected" style="display: none;">
                        <h4>Client s√©lectionn√© :</h4>
                        <div class="client-info">
                            <p><strong id="selectedClientName"></strong></p>
                            <p id="selectedClientInfo"></p>
                        </div>
                        <button class="btn-link" onclick="changerClient()">Changer de client</button>
                    </div>
                    
                    <div class="form-group" id="telephoneGroup" style="display: none;">
                        <label for="telephone">T√©l√©phone</label>
                        <input type="tel" id="telephone" name="telephone" readonly>
                    </div>
                    
                    <h3 style="margin-top: 30px;">üéß Type d'Appareil</h3>
                    
                    <div class="device-selection">
                        <label class="device-card">
                            <input type="radio" name="type_appareil" value="BTE" required>
                            <div class="icon">üîµ</div>
                            <div>BTE Classique</div>
                        </label>
                        <label class="device-card">
                            <input type="radio" name="type_appareil" value="RIC" required>
                            <div class="icon">üî¥</div>
                            <div>RIC/RITE</div>
                        </label>
                        <label class="device-card">
                            <input type="radio" name="type_appareil" value="ITE" required>
                            <div class="icon">üü¢</div>
                            <div>Intra (ITE/CIC)</div>
                        </label>
                    </div>
                    
                    <div class="form-group">
                        <label for="marque">Marque</label>
                        <div id="marqueAppareil"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="modele">Mod√®le (optionnel)</label>
                        <input type="text" id="modele" name="modele" placeholder="Ex: Audeo Paradise">
                    </div>
                    
                    <div class="form-group">
                        <label for="numeroSerie">Num√©ro de s√©rie (optionnel)</label>
                        <input type="text" id="numeroSerie" name="numeroSerie" placeholder="Ex: PH123456789">
                    </div>
                </div>
                
                <!-- √âtape 2 : Diagnostic -->
                <div class="step-content hidden" id="stepContent2">
                    <h3>‚ùì Probl√®me(s) D√©crit(s)</h3>
                    
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="pb1" name="probleme" value="Pas de son">
                            <label for="pb1">üîá Pas de son / Muet</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="pb2" name="probleme" value="Son faible">
                            <label for="pb2">üîâ Son faible</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="pb3" name="probleme" value="Sifflement">
                            <label for="pb3">üì¢ Sifflement (Larsen)</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="pb4" name="probleme" value="Son intermittent">
                            <label for="pb4">„Ä∞Ô∏è Son intermittent</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="pb5" name="probleme" value="Gr√©sille">
                            <label for="pb5">üì° Gr√©sille / Parasite</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="pb6" name="probleme" value="Humidit√©">
                            <label for="pb6">üíß Humidit√© / Condensation</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="pb7" name="probleme" value="Inconfort">
                            <label for="pb7">üò£ Inconfort / Douleur</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="pb8" name="probleme" value="Contr√¥le routine">
                            <label for="pb8">üîß Contr√¥le routine</label>
                        </div>
                    </div>
                </div>
                
                <!-- √âtape 3 : Actions & R√©sultat -->
                <div class="step-content hidden" id="stepContent3">
                    <h3>‚úÖ Actions R√©alis√©es</h3>
                    
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="act1" name="actions" value="Pile chang√©e">
                            <label for="act1">üîã Pile test√©e / chang√©e</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="act2" name="actions" value="Nettoyage complet">
                            <label for="act2">üßπ Nettoyage complet</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="act3" name="actions" value="Filtre chang√©">
                            <label for="act3">üîÑ Filtre pare-c√©rumen chang√©</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="act4" name="actions" value="D√¥me remplac√©">
                            <label for="act4">üîµ D√¥me remplac√©</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="act5" name="actions" value="Tube chang√©">
                            <label for="act5">üìè Tube chang√©</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="act6" name="actions" value="S√©chage">
                            <label for="act6">‚òÄÔ∏è S√©chage effectu√©</label>
                        </div>
                    </div>
                    
                    <h3 style="margin-top: 30px;">üìä R√©sultat de l'Intervention</h3>
                    
                    <div class="form-group">
                        <select id="resultat" name="resultat" required>
                            <option value="">S√©lectionner le r√©sultat</option>
                            <option value="R√©solu">‚úÖ Probl√®me r√©solu</option>
                            <option value="Partiel">‚ö†Ô∏è Am√©lioration partielle</option>
                            <option value="SAV">‚ùå Sans effet - Escalade SAV</option>
                            <option value="OK">üîß Contr√¥le OK</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="observations">üí¨ Observations (optionnel)</label>
                        <textarea id="observations" name="observations" rows="3" 
                                  placeholder="Commentaires additionnels..."></textarea>
                    </div>
                </div>
                
                <!-- √âtape 4 : Validation -->
                <div class="step-content hidden" id="stepContent4">
                    <h3>R√©capitulatif de l'intervention</h3>
                    
                    <div class="recap-section">
                        <h4>Client</h4>
                        <div id="recapClient"></div>
                    </div>
                    
                    <div class="recap-section">
                        <h4>Appareil</h4>
                        <div id="recapAppareil"></div>
                    </div>
                    
                    <div class="recap-section">
                        <h4>Diagnostic</h4>
                        <div id="recapDiagnostic"></div>
                    </div>
                    
                    <div class="recap-section">
                        <h4>R√©sultat</h4>
                        <div id="recapResultat"></div>
                    </div>
                </div>
            </div>
            
            <div class="modal-footer">
                <button class="btn btn-secondary" id="btnPrevStep" onclick="etapePrecedente()" disabled>
                    ‚Üê Pr√©c√©dent
                </button>
                <button class="btn btn-primary" id="btnNextStep" onclick="etapeSuivante()">
                    Suivant ‚Üí
                </button>
                <button class="btn btn-success hidden" id="btnValiderIntervention" onclick="validerIntervention()">
                    ‚úì D√©marrer l'intervention
                </button>
            </div>
        </div>
    </div>

    <!-- Modal D√©tail Intervention -->
    <div id="modalDetailIntervention" class="modal" style="display: none;">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2>D√©tail de l'intervention <span id="detailNumIntervention"></span></h2>
                <button class="modal-close">&times;</button>
            </div>
            
            <div class="modal-body">
                <!-- Timeline du statut -->
                <div class="timeline-container">
                    <div class="timeline" id="timeline">
                        <!-- Timeline g√©n√©r√©e dynamiquement -->
                    </div>
                </div>
                
                <!-- Sections d√©tail -->
                <div class="detail-sections">
                    <!-- Colonne de gauche -->
                    <div class="detail-column-left">
                        <!-- Section Client -->
                        <div class="detail-section">
                            <h3>Informations client</h3>
                            <div id="detailClient">
                                <!-- Contenu g√©n√©r√© dynamiquement -->
                            </div>
                        </div>
                        
                        <!-- Section Appareil -->
                        <div class="detail-section">
                            <h3>Appareil</h3>
                            <div id="detailAppareil">
                                <!-- Contenu g√©n√©r√© dynamiquement -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- Colonne de droite -->
                    <div class="detail-column-right">
                        <!-- Section Diagnostic -->
                        <div class="detail-section">
                            <h3>Diagnostic & Actions</h3>
                            <div id="detailDiagnostic">
                                <!-- Contenu g√©n√©r√© dynamiquement -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Section R√©sultat sur toute la largeur -->
                <div class="detail-section full-width">
                    <h3>R√©sultat & Observations</h3>
                    <div id="detailResultat">
                        <!-- Contenu g√©n√©r√© dynamiquement -->
                    </div>
                </div>
                
                <!-- Section Signatures si termin√©e -->
                <div class="detail-section full-width" id="sectionSignatures" style="display: none;">
                    <h3>Signatures</h3>
                    <div id="detailSignatures">
                        <!-- Contenu g√©n√©r√© dynamiquement -->
                    </div>
                </div>
                
                <!-- Actions selon le statut -->
                <div class="detail-actions" id="detailActions">
                    <!-- Boutons d'action g√©n√©r√©s selon le statut -->
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <div class="footer">
        <p>Orixis - ¬© 2025</p>
    </div>

    <script type="module" src="../src/js/pages/intervention/intervention.main.js"></script>

    <!-- Container pour les dialogs -->
    <div id="dialog-container"></div>

    <!-- Footer -->
    <div class="footer">
        <p>Orixis - ¬© 2025</p>
    </div>

    <script type="module">
        // Import unique du main qui g√®re tout
        import '../src/js/pages/intervention/intervention.main.js';
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fiche Intervention SAV - Aper√ßu</title>
    
    <style>
        /* Reset et base */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }
        
        @page {
            size: A4;
            margin: 10mm;
        }
        
        body {
            font-family: Arial, sans-serif;
            font-size: 11pt;
            line-height: 1.4;
            color: #000;
            background: #f5f5f5;
            margin: 0;
            padding: 20px;
        }
        
        .container {
            max-width: 210mm;
            margin: 0 auto;
            background: white;
            padding: 20mm;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }
        
        /* En-t√™te */
        .header {
            border: 2px solid #000;
            padding: 10px;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 18pt;
            margin-bottom: 5px;
        }
        
        .header p {
            font-size: 12pt;
            color: #333;
        }
        
        .info-bar {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            font-size: 10pt;
            color: #333;
        }
        
        /* Sections */
        .section {
            border: 1px solid #000;
            padding: 10px;
            margin-bottom: 12px;
            page-break-inside: avoid;
        }
        
        .section-title {
            font-size: 13pt;
            font-weight: bold;
            margin-bottom: 8px;
            padding-bottom: 5px;
            border-bottom: 2px solid #000;
        }
        
        /* Lignes d'info */
        .info-row {
            display: flex;
            margin-bottom: 8px;
            align-items: baseline;
        }
        
        .info-label {
            font-weight: bold;
            font-size: 10pt;
            min-width: 120px;
        }
        
        .info-value {
            flex: 1;
            border-bottom: 1px solid #333;
            padding-bottom: 2px;
            font-size: 11pt;
        }
        
        /* Grille date/heure */
        .date-time-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 8px;
        }
        
        /* Cases √† cocher */
        .checkbox-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin: 10px 0;
        }
        
        .checkbox-item {
            display: flex;
            align-items: center;
            font-size: 10pt;
        }
        
        .checkbox {
            width: 14px;
            height: 14px;
            border: 1px solid #000;
            margin-right: 8px;
            display: inline-block;
            position: relative;
        }
        
        .checkbox.checked:after {
            content: "‚úì";
            position: absolute;
            top: -2px;
            left: 2px;
            font-size: 12pt;
            font-weight: bold;
        }
        
        /* S√©lection appareil */
        .device-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 10px 0;
        }
        
        .device-option {
            border: 2px solid #000;
            padding: 8px;
            text-align: center;
            font-size: 10pt;
        }
        
        .device-option.selected {
            background: #ddd;
            font-weight: bold;
        }
        
        /* Zone texte */
        .text-area {
            border: 1px solid #333;
            padding: 5px;
            min-height: 50px;
            font-size: 10pt;
            margin-top: 5px;
        }
        
        /* Signatures */
        .signature-section {
            margin-top: 20px;
            page-break-inside: avoid;
        }
        
        .signature-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 10px;
        }
        
        .signature-box {
            border: 1px solid #000;
            padding: 10px;
            min-height: 100px;
            text-align: center;
        }
        
        .signature-label {
            font-size: 10pt;
            font-weight: bold;
            margin-bottom: 10px;
            display: block;
        }
        
        .signature-image {
            max-width: 100%;
            height: auto;
            max-height: 80px;
        }
        
        /* Footer */
        .footer {
            margin-top: 30px;
            padding-top: 10px;
            border-top: 1px solid #333;
            text-align: center;
            font-size: 9pt;
            color: #666;
        }
        
        /* Bouton d'impression flottant */
        .print-button {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16pt;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
        }
        
        .print-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }
        
        .no-data {
            text-align: center;
            padding: 50px;
            color: #666;
        }
        
        .no-data h2 {
            color: #333;
            margin-bottom: 20px;
        }
        
        .no-data a {
            color: #667eea;
            text-decoration: none;
            font-weight: bold;
        }
        
        .no-data a:hover {
            text-decoration: underline;
        }
        
        /* Mobile responsive */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .container {
                padding: 15mm;
            }
            
            .print-button {
                top: 10px;
                right: 10px;
                padding: 12px 20px;
                font-size: 14pt;
            }
            
            .checkbox-grid,
            .device-grid {
                grid-template-columns: 1fr;
            }
            
            .signature-grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* Masquer √† l'impression */
        @media print {
            body {
                background: white;
                padding: 0;
            }
            
            .container {
                box-shadow: none;
                padding: 10mm;
                max-width: none;
            }
            
            .print-button {
                display: none !important;
            }
        }
    </style>
</head>
<body>
    <button class="print-button" onclick="window.print()">
        üñ®Ô∏è Imprimer la fiche
    </button>
    
    <div class="container" id="content">
        <!-- Le contenu sera g√©n√©r√© dynamiquement -->
    </div>

    <script>
        // R√©cup√©rer les donn√©es du localStorage
        const data = localStorage.getItem('sav_intervention_data');
        const authData = localStorage.getItem('sav_auth');
        
        if (!data) {
            document.getElementById('content').innerHTML = `
                <div class="no-data">
                    <h2>Aucune donn√©e √† afficher</h2>
                    <p>Veuillez d'abord remplir le formulaire d'intervention.</p>
                    <br>
                    <a href="fiche-intervention.html">‚Üê Retour au formulaire</a>
                </div>
            `;
        } else {
            const intervention = JSON.parse(data);
            const auth = authData ? JSON.parse(authData) : { magasin: 'Non sp√©cifi√©' };
            
            // G√©n√©rer le contenu HTML
            let html = `
                <div class="header">
                    <h1>üîß FICHE D'INTERVENTION SAV AUDIO</h1>
                    <p>Contr√¥le / Nettoyage / Maintenance Niveau 1</p>
                </div>
                
                <div class="info-bar">
                    <span><strong>Magasin:</strong> ${auth.magasin}</span>
                    <span><strong>G√©n√©r√© le:</strong> ${new Date().toLocaleString('fr-FR')}</span>
                </div>
                
                <!-- Informations Client -->
                <div class="section">
                    <div class="section-title">üìã INFORMATIONS CLIENT</div>
                    <div class="date-time-grid">
                        <div class="info-row">
                            <span class="info-label">Date:</span>
                            <span class="info-value">${formatDate(intervention.date)}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Heure:</span>
                            <span class="info-value">${intervention.heure || 'Non sp√©cifi√©'}</span>
                        </div>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Nom du client:</span>
                        <span class="info-value">${intervention.nom || 'Non sp√©cifi√©'}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">T√©l√©phone:</span>
                        <span class="info-value">${intervention.telephone || 'Non sp√©cifi√©'}</span>
                    </div>
                </div>
                
                <!-- Type d'appareil -->
                <div class="section">
                    <div class="section-title">üéß TYPE D'APPAREIL</div>
                    <div class="device-grid">
                        <div class="device-option ${intervention.type_appareil === 'BTE' ? 'selected' : ''}">
                            BTE Classique
                        </div>
                        <div class="device-option ${intervention.type_appareil === 'RIC' ? 'selected' : ''}">
                            RIC/RITE
                        </div>
                        <div class="device-option ${intervention.type_appareil === 'ITE' ? 'selected' : ''}">
                            Intra (ITE/CIC)
                        </div>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Marque:</span>
                        <span class="info-value">${intervention.marque || 'Non sp√©cifi√©'}</span>
                    </div>
                </div>
                
                <!-- Probl√®me d√©crit -->
                <div class="section">
                    <div class="section-title">‚ùì PROBL√àME D√âCRIT</div>
                    <div class="checkbox-grid">
                        ${generateCheckboxes(intervention.problemes, [
                            'Pas de son',
                            'Son faible',
                            'Sifflement',
                            'Son intermittent',
                            'Gr√©sille',
                            'Humidit√©',
                            'Inconfort',
                            'Contr√¥le routine'
                        ])}
                    </div>
                </div>
                
                <!-- Actions r√©alis√©es -->
                <div class="section">
                    <div class="section-title">‚úÖ ACTIONS R√âALIS√âES</div>
                    <div class="checkbox-grid">
                        ${generateCheckboxes(intervention.actions, [
                            'Pile chang√©e',
                            'Nettoyage complet',
                            'Filtre chang√©',
                            'D√¥me remplac√©',
                            'Tube chang√©',
                            'S√©chage'
                        ])}
                    </div>
                </div>
                
                <!-- R√©sultat -->
                <div class="section">
                    <div class="section-title">üìä R√âSULTAT DE L'INTERVENTION</div>
                    <div class="info-row">
                        <span class="info-label">R√©sultat:</span>
                        <span class="info-value">${getResultatText(intervention.resultat)}</span>
                    </div>
                </div>
                
                <!-- Observations -->
                <div class="section">
                    <div class="section-title">üí¨ OBSERVATIONS</div>
                    <div class="text-area">
                        ${intervention.observations || 'Aucune observation particuli√®re'}
                    </div>
                </div>
                
                <!-- Signatures -->
                <div class="signature-section">
                    <div class="section">
                        <div class="section-title">‚úçÔ∏è SIGNATURES</div>
                        <div class="signature-grid">
                            <div class="signature-box">
                                <span class="signature-label">Signature du Client</span>
                                ${intervention.signatureClient ? 
                                    `<img src="${intervention.signatureClient}" class="signature-image" alt="Signature client">` : 
                                    '<p style="color: #999; margin-top: 30px;">Non sign√©</p>'
                                }
                            </div>
                            <div class="signature-box">
                                <span class="signature-label">Signature de l'Intervenant</span>
                                ${intervention.signatureIntervenant ? 
                                    `<img src="${intervention.signatureIntervenant}" class="signature-image" alt="Signature intervenant">` : 
                                    '<p style="color: #999; margin-top: 30px;">Non sign√©</p>'
                                }
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="footer">
                    Document g√©n√©r√© le ${new Date().toLocaleString('fr-FR')} - SAV Audio ¬© 2025
                </div>
            `;
            
            document.getElementById('content').innerHTML = html;
        }
        
        // Fonctions utilitaires
        function formatDate(dateString) {
            if (!dateString) return 'Non sp√©cifi√©';
            const date = new Date(dateString);
            return date.toLocaleDateString('fr-FR', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric'
            });
        }
        
        function generateCheckboxes(selected, options) {
            return options.map(option => `
                <div class="checkbox-item">
                    <span class="checkbox ${selected && selected.includes(option) ? 'checked' : ''}"></span>
                    <span>${option}</span>
                </div>
            `).join('');
        }
        
        function getResultatText(resultat) {
            const resultats = {
                'R√©solu': '‚úÖ Probl√®me r√©solu',
                'Partiel': '‚ö†Ô∏è Am√©lioration partielle',
                'SAV': '‚ùå Sans effet - Escalade SAV',
                'OK': 'üîß Contr√¥le OK'
            };
            return resultats[resultat] || resultat || 'Non sp√©cifi√©';
        }
        
        // Gestion de l'impression
        window.addEventListener('afterprint', function() {
            // Proposer de fermer la fen√™tre apr√®s impression
            if (window.opener) {
                setTimeout(() => {
                    if (confirm('Impression termin√©e. Fermer cette fen√™tre ?')) {
                        window.close();
                    }
                }, 500);
            }
        });
    </script>
</body>
</html>

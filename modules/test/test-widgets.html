<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test - Widgets</title>
    <link rel="stylesheet" href="../../src/css/main.css">
</head>
<body>
    <!-- Container pour les stats -->
    <div class="stats-container" style="margin: 100px 20px 20px 20px;"></div>
    
    <!-- Container pour les filtres -->
    <div class="filters-container" style="margin: 20px;"></div>
    
    <!-- Container pour la table -->
    <div class="table-container" style="margin: 20px;"></div>
    
    <script type="module">
        import { HeaderWidget } from '../../widgets/header/header.widget.js';
        import { StatsCardsWidget } from '../../widgets/stats-cards/stats-cards.widget.js';
        import { SearchFiltersWidget } from '../../widgets/search-filters/search-filters.widget.js';
        import { DataGridWidget } from '../../widgets/data-grid/data-grid.widget.js';
        import { PdfUploaderWidget } from '../../widgets/pdf-uploader/pdf-uploader.widget.js';

        // Au d√©but, ajoute l'import du DetailViewerWidget
        import { DetailViewerWidget } from '../../widgets/detail-viewer/detail-viewer.widget.js';

        
        // Header avec titre
        const header = new HeaderWidget({
            title: 'Gestion des Commandes',
            icon: 'üì¶',
            subtitle: "Commandes d'appareils et accessoires",
            showBack: true,
            showUser: true,
            showLogout: true
        });
        
        // Stats cards AVEC le wrapper int√©gr√©
        const stats = new StatsCardsWidget({
            container: '.stats-container',
            showWrapper: true,
            wrapperStyle: 'card',
            wrapperTitle: '',
            size: 'md',
            selectionMode: 'multiple',
            animated: true,
            cards: [
                { id: 'nouvelle', label: 'Nouvelle', icon: 'üìã', value: 6, color: 'info' },
                { id: 'preparation', label: 'En pr√©paration', icon: 'üîß', value: 1, color: 'warning' },
                { id: 'preparee', label: 'Pr√©par√©e', icon: 'üì¶', value: 5, color: 'danger' },
                { id: 'expediee', label: 'Exp√©di√©e', icon: 'üöö', value: 9, color: 'primary' },
                { id: 'receptionnee', label: 'R√©ceptionn√©e', icon: 'üì¨', value: 4, color: 'info' },
                { id: 'livree', label: 'Livr√©e', icon: '‚úÖ', value: 11, color: 'success' }
            ],
            onSelect: (selectedIds) => {
                console.log('Cartes s√©lectionn√©es:', selectedIds);
            }
        });
        
        // Filtres de recherche AVEC le wrapper int√©gr√©
        const filters = new SearchFiltersWidget({
            container: '.filters-container',
            showWrapper: true,
            wrapperStyle: 'card',
            wrapperTitle: 'Filtres',
            filters: [
                { 
                    type: 'search', 
                    key: 'search', 
                    placeholder: 'Rechercher une commande...' 
                },
                { 
                    type: 'select', 
                    key: 'status', 
                    label: 'Statut',
                    options: [
                        { value: 'nouvelle', label: 'Nouvelle', icon: 'üìã' },
                        { value: 'preparation', label: 'En pr√©paration', icon: 'üîß' },
                        { value: 'preparee', label: 'Pr√©par√©e', icon: 'üì¶' },
                        { value: 'expediee', label: 'Exp√©di√©e', icon: 'üöö' },
                        { value: 'livree', label: 'Livr√©e', icon: '‚úÖ' }
                    ],
                    searchable: true
                },
                { 
                    type: 'select', 
                    key: 'magasin', 
                    label: 'Magasin',
                    options: [
                        { value: 'paris', label: 'Paris', icon: 'üè™' },
                        { value: 'lyon', label: 'Lyon', icon: 'üè¨' },
                        { value: 'marseille', label: 'Marseille', icon: 'üè¢' }
                    ],
                    searchable: true,
                    multiple: true
                },
                { 
                    type: 'date', 
                    key: 'date', 
                    label: 'Date commande' 
                }
            ],
            onFilter: (values) => {
                console.log('Filtres appliqu√©s:', values);
            }
        });
        
        // DataGrid AVEC donn√©es de test
        const grid = new DataGridWidget({
            container: '.table-container',
            showWrapper: true,
            wrapperStyle: 'card',
            wrapperTitle: '',  // Pas de titre
            columns: [
                { key: 'date', label: 'Date', sortable: true, width: 100 },
                { key: 'magasin', label: 'Magasin', sortable: true, width: 100 },
                { key: 'client', label: 'Client', sortable: true, width: 200 },
                { key: 'type', label: 'Type de pr√©paration', sortable: true, width: 180 },
                { key: 'urgence', label: 'Urgence', sortable: true, width: 120 },
                { 
                    key: 'statut', 
                    label: 'Statut', 
                    sortable: true,
                    width: 120,
                    formatter: (v) => {
                        const badges = {
                            'Nouvelle': 'badge-info',
                            'Pr√©par√©e': 'badge-warning',
                            'Exp√©di√©e': 'badge-primary',
                            'Livr√©e': 'badge-success',
                            'Annul√©e': 'badge-danger'
                        };
                        return `<span class="badge ${badges[v] || 'badge-secondary'}">${v}</span>`;
                    }
                },
                { 
                    type: 'actions',
                    label: 'Actions',
                    width: 60,
                    actions: [
                        { 
                            type: 'view',
                            title: 'Voir les d√©tails',
                            onClick: (row, index) => {
                                // Ouvrir le modal DetailViewer avec les donn√©es de la ligne
                                new DetailViewerWidget({
                                    title: `Commande du ${row.date}`,
                                    subtitle: `${row.client} - ${row.magasin}`,
                                    data: row,
                                    
                                    // Timeline optionnelle pour montrer le statut
                                    timeline: {
                                        enabled: true,
                                        orientation: 'horizontal',
                                        items: [
                                            { 
                                                label: 'Nouvelle', 
                                                status: row.statut === 'Nouvelle' ? 'active' : 'completed',
                                                icon: 'üìã'
                                            },
                                            { 
                                                label: 'Pr√©par√©e', 
                                                status: row.statut === 'Pr√©par√©e' ? 'active' : 
                                                        row.statut === 'Nouvelle' ? 'pending' : 'completed',
                                                icon: 'üì¶'
                                            },
                                            { 
                                                label: 'Exp√©di√©e', 
                                                status: row.statut === 'Exp√©di√©e' ? 'active' : 
                                                        ['Nouvelle', 'Pr√©par√©e'].includes(row.statut) ? 'pending' : 'completed',
                                                icon: 'üöö'
                                            },
                                            { 
                                                label: 'Livr√©e', 
                                                status: row.statut === 'Livr√©e' ? 'completed' : 
                                                        row.statut === 'Annul√©e' ? 'error' : 'pending',
                                                icon: row.statut === 'Annul√©e' ? '‚ùå' : '‚úÖ'
                                            }
                                        ],
                                        theme: 'colorful',
                                        size: 'small'
                                    },
                                    
                                    // Sections avec les d√©tails
                                    sections: [
                                        {
                                            id: 'client',
                                            title: 'üë§ Informations Client',
                                            fields: [
                                                { label: 'Client', key: 'client', bold: true },
                                                { label: 'Magasin', key: 'magasin' },
                                                { label: 'Date commande', key: 'date' }
                                            ]
                                        },
                                        {
                                            id: 'commande',
                                            title: 'üì¶ D√©tails Commande',
                                            fields: [
                                                { label: 'Type', key: 'type' },
                                                { label: 'Urgence', key: 'urgence' },
                                                { 
                                                    label: 'Statut', 
                                                    key: 'statut',
                                                    formatter: (value) => {
                                                        const badges = {
                                                            'Nouvelle': 'badge-info',
                                                            'Pr√©par√©e': 'badge-warning',
                                                            'Exp√©di√©e': 'badge-primary',
                                                            'Livr√©e': 'badge-success',
                                                            'Annul√©e': 'badge-danger'
                                                        };
                                                        return `<span class="badge ${badges[value] || 'badge-secondary'}">${value}</span>`;
                                                    },
                                                    html: true
                                                }
                                            ]
                                        }
                                    ],
                                    
                                    // Actions du modal
                                    actions: [
                                        {
                                            label: 'Suivant',
                                            class: 'btn btn-glass-blue btn-lg',
                                            icon: '‚Üí',
                                            onClick: (data) => {
                                                console.log('Suivant:', data);
                                                // Votre logique ici
                                                // Par exemple : passer √† la commande suivante
                                            },
                                            closeOnClick: true  // Ferme apr√®s le clic
                                        }
                                    ],
                                    
                                    // Options
                                    size: 'large',
                                    theme: 'default',
                                    destroyOnClose: true
                                });
                            }
                        }
                    ]
                }
            ],
            data: [
                { date: '05/08/2025', magasin: '9AVA', client: 'FATIMA ABDI ESSABER', type: 'üì¶ Livraison premi√®re paire', urgence: 'üïê Normal (3-5 jours)', statut: 'Pr√©par√©e' },
                { date: '05/08/2025', magasin: '9AVA', client: 'FATIMA ABDI ESSABER', type: 'üì¶ Livraison premi√®re paire', urgence: '‚ö° Urgent (48h)', statut: 'Livr√©e' },
                { date: '03/08/2025', magasin: '9AVA', client: 'MARIA FELICIANA ACACIO', type: 'üì¶ Livraison deuxi√®me paire', urgence: 'üïê Normal (3-5 jours)', statut: 'Livr√©e' },
                { date: '03/08/2025', magasin: '9BEA', client: 'MARTINE AUREAU', type: 'üîß Livraison accessoire', urgence: 'üïê Normal (3-5 jours)', statut: 'Nouvelle' },
                { date: '03/08/2025', magasin: '9CHE', client: 'GASTON ALHELY', type: 'üì¶ Livraison premi√®re paire', urgence: 'üïê Normal (3-5 jours)', statut: 'Nouvelle' },
                { date: '03/08/2025', magasin: '9BOM', client: 'FATIMA ABDI ESSABER', type: 'üì¶ Livraison premi√®re paire', urgence: 'üïê Normal (3-5 jours)', statut: 'Nouvelle' },
                { date: '01/08/2025', magasin: '9BEA', client: 'AHMED ARAB', type: 'üì¶ Livraison premi√®re paire', urgence: 'üïê Normal (3-5 jours)', statut: 'Annul√©e' },
                { date: '31/07/2025', magasin: '9BEA', client: 'ALAIN AFFLELOU ACOUSTICIEN', type: 'üì¶ Livraison deuxi√®me paire', urgence: 'üïê Normal (3-5 jours)', statut: 'Livr√©e' },
                { date: '31/07/2025', magasin: '9AVA', client: 'MARGUERITE ACQUART', type: 'üì¶ Livraison deuxi√®me paire', urgence: 'üïê Normal (3-5 jours)', statut: 'Exp√©di√©e' }
            ],
            features: {
                sort: true,
                export: true,
                selection: false,  // Pas de checkboxes comme dans l'image
                pagination: true,
                resize: false      // Pas de resize dans l'image
            },
            pagination: {
                itemsPerPage: 10,   // Nombre par d√©faut
                pageSizeOptions: [10, 20, 50, 100],  // Options disponibles
                showPageInfo: true  // Afficher l'info
            },
            onRowClick: (row) => {
                console.log('Ligne cliqu√©e:', row);
            }
        });

        setTimeout(() => {
            const actionsZone = document.querySelector('.data-grid-export-buttons');
            if (actionsZone) {
                // Cr√©er les boutons
                const buttons = [
                    { 
                        text: '‚ûï Nouveau document', 
                        class: 'btn-ghost-success', 
                        action: () => {
                            new PdfUploaderWidget({
                                title: 'Nouveau Document',
                                theme: 'purple',
                                mode: 'simple',
                                description: {
                                    icon: 'üìÑ',
                                    title: 'Upload de documents',
                                    text: 'D√©posez vos fichiers PDF ou images. Notre syst√®me les analysera automatiquement.'
                                },
                                saveButtonText: 'üíæ Enregistrer',
                                onSave: async (data) => {
                                    console.log('üìÅ Fichiers √† traiter:', data.files);
                                    
                                    // Simuler un traitement
                                    await new Promise(resolve => setTimeout(resolve, 1000));
                                    
                                    // Afficher un message de succ√®s (optionnel)
                                    alert(`‚úÖ ${data.files.length} document(s) enregistr√©(s) !`);
                                    
                                    // Rafra√Æchir la grid (optionnel)
                                    // grid.refresh();
                                    
                                    return true;
                                },
                                onClose: () => {
                                    console.log('Modal ferm√©');
                                }
                            });
                        }
                    },
                    { text: 'üìÑ Export CSV', class: 'btn-ghost-info', action: () => grid.export('csv') },
                    { text: 'üìä Export Excel', class: 'btn-ghost-purple', action: () => grid.export('excel') }
                ];
                
                buttons.forEach(btn => {
                    const button = document.createElement('button');
                    button.className = `btn btn-ghost-colored ${btn.class} btn-sm`;
                    button.innerHTML = btn.text;
                    button.onclick = btn.action;
                    actionsZone.appendChild(button);
                });
            }
        }, 100);
        
        // Test de mise √† jour des stats apr√®s 3 secondes
        setTimeout(() => {
            stats.updateAll({
                nouvelle: 10,
                preparation: 3,
                preparee: 7,
                expediee: 12,
                receptionnee: 6,
                livree: 15
            });
        }, 3000);
    </script>
</body>
</html>